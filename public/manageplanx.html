<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Dashboard</title>
        <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.4/dist/tailwind.min.css"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="css/app.css" />
        <link
            rel="stylesheet"
            href="assets/css/plugins/fontawesome-all.min.css"
        />

        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <!-- CSS Assets -->

        <!-- Javascript Assets -->
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/1.13.0/css/jquery.dataTables.min.css"
        />
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.0/js/jquery.dataTables.min.js"></script>
        <script src="js/app.js" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.0/dist/tailwind.min.css"
            rel="stylesheet"
        />

        <!-- JS
     ============================================ -->
        <script src="assets/js/vendor/modernizr.min.js"></script>
        <!-- <script src="assets/js/vendor/jquery.min.js"></script> -->

        <!-- Fonts -->

        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
        <link rel="stylesheet" href="assets/css/style.css" />
        <!-- CSS ============================================ -->
        <script src="assets/js/vendor/bootstrap.min.js"></script>
        <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css" />

        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap"
            rel="stylesheet"
        />
        <style>
            .dot {
                transition: transform 0.2s ease-in-out;
            }
            input:checked + .block {
                background-color: #4caf50;
            }
            input:checked + .block .dot {
                transform: translateX(100%);
            }
        </style>
        <style>
            /* Custom class for the <a> elements */
            .custom-li {
                color: #f97316; /* Tailwind's text-orange-500 */
                background-color: transparent; /* Default background color */
                padding: 0.5rem 1rem; /* px-4 py-2 */
                border-radius: 0.5rem; /* rounded-lg */
                transition: color 0.3s ease, background-color 0.3s ease; /* transition-colors duration-300 */
                text-decoration: none; /* Remove underline from links */
            }

            .custom-li:hover {
                color: #f97316; /* Tailwind's hover:text-orange-700 (same color in this example) */
                background-color: #fef3c7; /* Tailwind's hover:bg-orange-100 */
            }
        </style>
        <style>
            /* Base Styling */
            body {
                font-family: 'Poppins', sans-serif;
                font-size: 1.2rem;
                background-color: #f4f7f9;
                color: #333;
                margin: 0;
                padding: 0;
            }

            /* Sidebar Styling */
            .Sidebar--bars {
                height: auto;
                width: 20% !important;
                background-color: #252a34;
                color: #fff;
                font-size: 14px;
                padding-top: 20px;
            }

            .sidebar {
                padding: 20px;
            }

            .sidebar-admin ul {
                list-style-type: none;
                margin: 0;
                padding: 0;
            }

            .sidebar-admin ul li {
                padding: 15px 10px;
                margin: 5px 0;
                border-radius: 5px;
                transition: background 0.3s ease;
            }

            .sidebar-admin ul li.active {
                background: #fca311;
                color: #000;
            }

            .sidebar-admin ul li:hover {
                background: #444b54;
                cursor: pointer;
            }

            /* Main Content Styling */
            .flex-1.p-6 {
                width: 75% !important;
                background-color: #ffffff;
                padding: 30px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                border-radius: 10px;
                margin: 20px;
            }

            /* Headings */
            h1,
            h2,
            h4,
            h6 {
                color: #252a34;
                font-weight: 600;
            }

            /* Table Styling */
            thead {
                background: #fca311;
                height: 60px;
            }

            thead th {
                color: #fff;
                font-weight: 500;
            }

            tbody tr {
                transition: background 0.2s ease;
            }

            tbody tr:hover {
                background: #f5f5f5;
            }

            .rainbow-compare-table.style-1 table th.style-prymary {
                background: #252a34 !important;
                color: #fff !important;
            }

            #planTable_filter,
            #planTable_length {
                display: none;
            }

            /* Form Elements */
            input,
            select,
            textarea {
                height: 40px !important;
                border: 1px solid #fca311 !important;
                border-radius: 5px !important;
                background: #fff !important;
                padding: 10px;
                margin-bottom: 20px;
                width: 100%;
                box-sizing: border-box;
                font-size: 1rem;
                color: #333;
            }

            input:focus,
            select:focus,
            textarea:focus {
                border-color: #252a34 !important;
                outline: none;
                box-shadow: 0 0 5px rgba(252, 163, 17, 0.5);
            }

            /* Buttons */
            button {
                padding: 10px 20px !important;
                background-color: #fca311;
                color: #fff;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: 600;
                transition: background 0.3s ease;
            }
            /* Common Section Styling */
            .hidden {
                display: none;
            }

            .min-h-screen {
                min-height: 100vh;
            }

            .bg-gray-100 {
                background-color: #f4f7f9;
            }

            .text-gray-700 {
                color: #333;
            }

            .text-gray-600 {
                color: #555;
            }

            /* Form Styling */
            form {
                background-color: #fff;
                padding: 2rem;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                width: 100%;
                max-width: 400px;
            }

            input,
            select,
            textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background: #fff;
                margin-bottom: 1rem;
                font-size: 1rem;
                color: #333;
            }

            input:focus,
            select:focus,
            textarea:focus {
                border-color: #007bff;
                outline: none;
                box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
            }

            button {
                width: 100%;
                padding: 10px 15px;
                background-color: #007bff;
                color: #fff;
                border: none;
                border-radius: 5px;
                font-weight: 600;
                cursor: pointer;
                transition: background-color 0.3s;
            }

            button:hover {
                background-color: #0056b3;
            }

            /* Table Styling */
            #adminTable {
                width: 100%;
                border-collapse: collapse;
                margin-top: 2rem;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            #adminTable thead {
                background-color: #007bff;
                color: #fff;
            }

            #adminTable th,
            #adminTable td {
                padding: 15px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            #adminTable tbody tr:hover {
                background-color: #f1f1f1;
            }

            /* Headings */
            h2,
            h1 {
                color: #333;
                margin-bottom: 1rem;
            }

            .text-center {
                text-align: center;
            }

            .text-3xl {
                font-size: 2rem;
            }

            .text-2xl {
                font-size: 1.75rem;
            }

            .font-semibold {
                font-weight: 600;
            }

            /* Additional Styling */
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .overflow-x-auto {
                overflow-x: auto;
            }

            .rounded-lg {
                border-radius: 10px;
            }

            .shadow-md {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }

            .mb-6 {
                margin-bottom: 1.5rem;
            }

            .my-8 {
                margin-top: 2rem;
                margin-bottom: 2rem;
            }

            .p-6 {
                padding: 1.5rem;
            }

            .p-8 {
                padding: 2rem;
            }
            button:hover {
                background-color: #e89c0f;
            }

            button:focus {
                outline: none;
                box-shadow: 0 0 5px rgba(252, 163, 17, 0.5);
            }

            /* Scrollable Sections */
            #rainbow-compare-table,
            #manageplanSection,
            #addplanSection,
            #manageProjectsSection,
            #ManagemainSection,
            #manageAdminSection,
            #manageUsersSection,
            #manageSubmitsAndPricingSection,
            #editplanSection,
            #addplanSection,
            #ManageCompareSection,
            #EditComparesectionsection {
                height: 100vh;
                overflow-y: auto;
                padding-bottom: 4rem;
            }

            /* Custom Scrollbar */
            ::-webkit-scrollbar {
                width: 8px;
            }

            ::-webkit-scrollbar-track {
                background: #f4f7f9;
            }

            ::-webkit-scrollbar-thumb {
                background: #252a34;
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: #fca311;
            }
            /* Base button styling */
            .admin-button {
                background-color: #1f2937; /* Dark background color for the button */
                border: none; /* Remove default border */
                border-radius: 0.375rem; /* Rounded corners */
                color: rgb(210, 95, 42); /* Text color */
                padding: 0.5rem 1rem; /* Padding for spacing */
                font-size: 1.3rem; /* Font size */
                cursor: pointer; /* Pointer cursor on hover */
                display: inline-flex; /* Align items properly */
                align-items: center; /* Center align text */
                text-align: center; /* Center text alignment */
                transition: background-color 0.3s; /* Smooth background color transition */
            }

            /* Styling the link inside the button */
            .admin-button .admin-link {
                color: inherit; /* Inherit the button text color */
                text-decoration: none; /* Remove underline from the link */
                display: block; /* Make the link fill the button */
                width: 100%; /* Ensure the link spans the full width of the button */
            }

            /* Hover effect */
            .admin-button:hover {
                background-color: #374151; /* Slightly lighter shade on hover */
            }

            /* Optional: Focus styling for accessibility */
            .admin-button:focus {
                outline: 2px solid #60a5fa; /* Blue outline for focus indication */
                outline-offset: 2px; /* Offset outline slightly from the button */
            }
            .hidden {
                display: none;
            }
        </style>
    </head>
    <body class="bg-gray-100">
        <div class="flex">
            <!-- Sidebar -->
            <div class="w-64 h-screen bg-dark sidebar text-white Sidebar--bars">
                <div class="p-4 text-2xl font-semibold">Admin Dashboard</div>
                <div class="sideBar">
                    <div class="sidebar-admin">
                        <div class="sidebar-admin">
                            <ul class="mt-8" id="listAllnavigators">
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageAdminBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageAdminBtn"
                                            class="admin-link"
                                            >Manage Admin</a
                                        >
                                    </button>
                                </li>

                                <ul
                                    class="ml-4 mt-2 hidden"
                                    id="allAdminFunctions"
                                >
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        id="registerAdmin"
                                    >
                                        <button class="admin-button">
                                            🚀 Register Admin
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        id="changeAdminPasswordSectionBtn"
                                    >
                                        <button class="admin-button">
                                            🚀 Change Admin Password
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        id="adminListBtn"
                                    >
                                        <button class="admin-button">
                                            🚀 Admin List
                                        </button>
                                    </li>
                                </ul>

                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageUsersBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageUsersBtn"
                                            class="admin-link"
                                            >Manage Users</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageSubmitsAndPricingBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageSubmitsAndPricingBtn"
                                            class="admin-link"
                                            >Manage User Submits and Pricing</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageProjectAiBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageProjectAiBtn"
                                            class="admin-link"
                                            >Manage Projects</a
                                        >
                                    </button>
                                </li>

                                <ul
                                    class="ml-4 mt-2 hidden"
                                    id="manageProjectslinkBtn"
                                >
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category=""
                                    >
                                        <button class="admin-button">
                                            🚀 All Projects
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Video Editor AI"
                                    >
                                        <button class="admin-button">
                                            🚀 Video Editor
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Video Restyling AI"
                                    >
                                        <button class="admin-button">
                                            🚀 Video Restyle
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Video Voicing"
                                    >
                                        <button class="admin-button">
                                            🚀 Video Voicing
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Lip Sync AI"
                                    >
                                        <button class="admin-button">
                                            🚀 Lip Sync
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Face Swap AI"
                                    >
                                        <button class="admin-button">
                                            🚀 Face Swap
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="3D Video Modeling AI"
                                    >
                                        <button class="admin-button">
                                            🚀 3D Video Modeling
                                        </button>
                                    </li>
                                    <li
                                        class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                        data-category="Add Avatar"
                                    >
                                        <button class="admin-button">
                                            🚀 My Avatar
                                        </button>
                                    </li>
                                </ul>

                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageplanBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageplanBtn"
                                            class="admin-link"
                                            >Manage Plans Pricing View</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="addplanBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=addplanBtn"
                                            class="admin-link"
                                            >Add More Pricing Plan View</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="ManageComparisonBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=ManageComparisonBtn"
                                            class="admin-link"
                                            >Manage Pricing Plan View
                                            Comparison</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="AddComparisonBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=AddComparisonBtn"
                                            class="admin-link"
                                            >Add More Pricing Plan Comparison</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageAvatarBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="manageavatar.html"
                                            class="admin-link"
                                            >Manage Avatar</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="router px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="managePackagesBtn"
                                    data-url="manage-packages"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="manageplanx.html"
                                            class="admin-link"
                                            >Manage Subscription Plans and
                                            Packages</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageVideoBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageVideoBtn"
                                            class="admin-link"
                                            >Manage Affilate & Add Video</a
                                        >
                                    </button>
                                </li>
                                <li
                                    class="px-4 py-2 custom-button hover:bg-gray-600 cursor-pointer"
                                    id="manageNewsletterBtn"
                                >
                                    <button class="admin-button">
                                        <a
                                            href="admin-dashboard.html?trigger=manageNewsletterBtn"
                                            class="admin-link"
                                            >Manage Newsletter</a
                                        >
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button
                    class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                    id="logoutBtn"
                >
                    Logout
                </button>
            </div>

            <div class="container mx-auto p-4">
                <h1 class="text-2xl font-bold mb-4">
                    Manage Subscription Packages
                </h1>

                <!-- Section for Adding New Package -->
                <div>
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-2">
                            Add New Package
                        </h2>
                        <button
                            id="AddPackageBtn"
                            class="px-4 py-2 bg-blue-500 text-white rounded"
                        >
                            Add Package
                        </button>
                    </div>

                    <!-- Section for Updating Existing Packages -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-2">
                            Update Existing Packages
                        </h2>
                        <button
                            id="UpdatePackageBtn"
                            class="px-4 py-2 bg-green-500 text-white rounded"
                        >
                            Update Package
                        </button>
                    </div>
                </div>
            </div>

            <!-- Container for displaying and managing packages -->
            <div id="packagesContainer" class="space-y-4">
                <!-- Package forms will be dynamically added here -->
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    let AvailablePackages = {};

                    document
                        .getElementById('AddPackageBtn')
                        .addEventListener('click', () =>
                            addNewPackageField(undefined, false)
                        );
                    document
                        .getElementById('UpdatePackageBtn')
                        .addEventListener('click', displayPackagesForUpdate);

                    getPackages();
                });

                async function updatePackage(data) {
                    try {
                        const response = await fetch('/api/packages', {
                            method: 'PUT',
                            body: JSON.stringify(data),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        const data = await response.json();
                        console.log(data);
                    } catch (error) {
                        console.log('🚀 ~ updatePackage ~ error:', error);
                    }
                }

                async function createPackage(data) {
                    try {
                        const response = await fetch('/api/packages', {
                            method: 'POST',
                            body: JSON.stringify(data),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        const data = await response.json();
                        console.log(data);
                    } catch (error) {
                        console.log('🚀 ~ createPackage ~ error:', error);
                    }
                }

                function getPackages() {
                    fetch('/api/packages')
                        .then((response) => response.json())
                        .then(async ({ data }) => {
                            const resq = await fetch('/api/packages/list');
                            AvailablePackages = (await resq.json()).data;

                            let options = '';
                            for (const pkg of AvailablePackages.allowedPackages) {
                                options += `<option value='${pkg.name}'>${pkg.name}</option>`;
                            }

                            const packageSelect =
                                document.getElementById('subscriptionPlan');
                            packageSelect.innerHTML = options;

                            for (const pkg of data.pkgs) {
                                addNewPackageField(pkg);
                            }
                        });
                }

                function buildFormData(form) {
                    const formData = new FormData(form);
                    const formObject = {};
                    const benefits = [];

                    for (const [key, value] of formData) {
                        if (key === 'benefits') {
                            benefits.push({ name: value, isAvailable: false });
                        } else if (
                            key === 'isAvailable' &&
                            benefits.length > 0
                        ) {
                            benefits[benefits.length - 1].isAvailable =
                                value == 'on';
                        } else {
                            if (formObject[key]) {
                                if (Array.isArray(formObject[key])) {
                                    formObject[key].push(value);
                                } else {
                                    formObject[key] = [formObject[key], value];
                                }
                            } else {
                                formObject[key] = value;
                            }
                        }
                    }

                    formObject.benefits = benefits;
                    return formObject;
                }

                function addNewPackageField(pkg, isNew = true) {
                    const container = document.createElement('form');
                    const benefitInfoField = document.createElement('p');
                    const benefitcontainer = document.createElement('div');
                    const packagePrice = document.createElement('input');
                    const packageHiddenId = document.createElement('input');
                    const addBenefitBtn = document.createElement('button');
                    const removePackageBtn = document.createElement('button');
                    const submitButton = document.createElement('button');
                    const indicator = document.createElement('p');

                    benefitInfoField.innerText =
                        'Please check the box if the corresponding benefit is available for this package';
                    const packageName = document.createElement('select');
                    packageName.name = 'name';
                    packageName.disabled = isNew;

                    const packageInterval = document.createElement('select');
                    packageInterval.name = 'interval';
                    packageInterval.disabled = isNew;

                    AvailablePackages?.allowedIntervals?.forEach((el) => {
                        const option = document.createElement('option');
                        option.value = el;
                        option.innerText = pkg?.interval || el;
                        packageInterval.append(option);
                    });

                    AvailablePackages?.allowedPackages?.forEach((el) => {
                        const option = document.createElement('option');
                        option.value = el.name;
                        option.innerText = pkg?.name || el.name;
                        packageName.append(option);
                    });

                    packageHiddenId.name = 'packageId';
                    packageHiddenId.value = pkg?._id || '';
                    packageHiddenId.hidden = true;

                    packagePrice.name = 'amount';
                    packagePrice.value = pkg?.amount || '';
                    packagePrice.disabled = pkg?.name === 'Free';

                    packageName.placeholder = 'Write Package name';
                    packagePrice.placeholder = 'Add Price';
                    packageInterval.placeholder = 'month, year';

                    container.className =
                        'p-4 border border-blue-500 my-4 bg-gray-300 rounded-md';
                    benefitInfoField.className =
                        'p-4 border my-4 bg-yellow-100 text-yellow-600';
                    benefitcontainer.className = 'p-2';
                    packageName.className = 'p-2 mr-2';
                    indicator.className =
                        'p-2 mr-2 !text-red-500 error-message';
                    packagePrice.className = 'p-2 mr-2';
                    packageInterval.className = 'p-2 mr-2';

                    addBenefitBtn.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2';
                    removePackageBtn.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2';
                    submitButton.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2 text-white';

                    removePackageBtn.type = 'button';
                    addBenefitBtn.type = 'button';
                    submitButton.type = 'submit';

                    addBenefitBtn.innerText = 'Add benefit';
                    removePackageBtn.innerText = 'Dismiss Section';
                    submitButton.innerText = 'Create Package';

                    pkg?.benefits.map((b) => {
                        addBenefitField(benefitcontainer, b);
                    });

                    addBenefitBtn.addEventListener('click', () =>
                        addBenefitField(benefitcontainer, undefined)
                    );
                    removePackageBtn.addEventListener('click', () => {
                        if (
                            packageName.value.length < 2 ||
                            packagePrice.value.length < 2 ||
                            packageInterval.value.length < 2
                        ) {
                            if (confirm('Your inputs will be cleared')) {
                                container.remove();
                            }
                        } else {
                            container.remove();
                        }
                    });

                    container.append(
                        packageName,
                        packagePrice,
                        packageInterval,
                        addBenefitBtn,
                        removePackageBtn,
                        packageHiddenId
                    );
                    container.append(benefitInfoField, benefitcontainer);
                    container.append(indicator, submitButton);

                    container.addEventListener('submit', (event) =>
                        handleSubmitNewPackage(event, indicator)
                    );

                    document
                        .getElementById('packagesContainer')
                        .append(container);
                }

                async function handleSubmitNewPackage(event, indicator) {
                    event.preventDefault();

                    const formData = buildFormData(event.target);
                    const formElements = event.target.elements;

                    try {
                        for (let i = 0; i < formElements.length; i++) {
                            formElements[i].disabled = true;
                        }
                        indicator.textContent =
                            'Please wait. Submitting Plan....';

                        const response = await fetch(
                            `/api/packages${
                                formData?.packageId
                                    ? `/${formData?.packageId}`
                                    : ''
                            }`,
                            {
                                method: `${
                                    formData?.packageId ? `PUT` : 'POST'
                                }`,
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ packages: formData }),
                            }
                        );

                        const data = await response.json();
                        if (!data.success) {
                            indicator.textContent = data.errors;
                            return;
                        }

                        indicator.textContent = 'Plan Created successfully';
                    } catch (error) {
                        console.log(
                            '🚀 ~ handleSubmitNewPackage ~ error:',
                            error
                        );
                        indicator.textContent = 'An error occurred';
                    } finally {
                        for (let i = 0; i < formElements.length; i++) {
                            formElements[i].disabled = false;
                        }

                        setTimeout(() => {
                            indicator.textContent = '';
                        }, 2500);
                    }
                }

                function addBenefitField(container, benefit) {
                    const benefitInput = document.createElement('input');
                    const isAvailableCheckbox = document.createElement('input');
                    const removeBenefitBtn = document.createElement('button');

                    benefitInput.name = 'benefits';
                    benefitInput.placeholder = 'Add Benefit';
                    benefitInput.value = benefit?.name || '';
                    benefitInput.className = 'p-2 mr-2';

                    isAvailableCheckbox.type = 'checkbox';
                    isAvailableCheckbox.name = 'isAvailable';
                    isAvailableCheckbox.checked = benefit?.isAvailable || false;

                    removeBenefitBtn.type = 'button';
                    removeBenefitBtn.innerText = 'Remove Benefit';
                    removeBenefitBtn.className =
                        'p-2 border bg-red-500 text-white rounded-md ml-2';
                    removeBenefitBtn.addEventListener('click', () => {
                        container.removeChild(benefitInput);
                        container.removeChild(isAvailableCheckbox);
                        container.removeChild(removeBenefitBtn);
                    });

                    container.append(
                        benefitInput,
                        isAvailableCheckbox,
                        removeBenefitBtn
                    );
                }

                function displayPackagesForUpdate() {
                    const container =
                        document.getElementById('packagesContainer');
                    container.innerHTML = '';

                    fetch('/api/packages')
                        .then((response) => response.json())
                        .then(async ({ data }) => {
                            data.pkgs.forEach((pkg) => {
                                addNewPackageField(pkg, false);
                            });
                        });
                }
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const routers = document.querySelectorAll('.router');
                    const path = new URL(window.location).pathname;

                    routers.forEach(
                        (el) => el.addEventListener('click', handleRouting),
                        false
                    );

                    function handleRouting($this) {
                        const url = $this.target.dataset.url;
                        window.history.pushState(url, undefined, `/${url}`);
                        document
                            .querySelectorAll(`.sidebar-content`)
                            .forEach((el) => el.classList.add('hidden'));
                        document
                            .querySelector(`.${url.replaceAll('/', '')}`)
                            .classList.remove('hidden');
                    }
                });
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const fetchUsers = async () => {
                        try {
                            const response = await axios.get('/api/users');
                            const users = response.data.users;
                            const userTableBody =
                                document.getElementById('userTableBody');
                            userTableBody.innerHTML = '';

                            users.forEach((user, index) => {
                                const row = document.createElement('tr');
                                row.classList.add(
                                    'bg-gray-100',
                                    'border-b',
                                    'hover:bg-gray-200',
                                    'text-sm',
                                    'font-medium'
                                );

                                row.innerHTML = `
                <td class="py-2 px-4">${index + 1}</td>
                <td class="py-2 px-4">${user._id}</td>
                <td class="py-2 px-4">${user.firstName} ${
                                    user.lastName || ''
                                }</td>
                <td class="py-2 px-4">${user.email}</td>
                <td class="py-2 px-4">${user.phoneNumber || 'N/A'}</td>
                <td class="py-2 px-4">${user.address || 'N/A'}</td>
                <td class="py-2 px-4">${user.subscriptionPlan}</td>
                <td class="py-2 px-4">
                    <button
                        onclick="deleteUser('${user._id}')"
                        class="text-red-600 hover:text-red-800 font-semibold mr-4">
                        Delete user
                    </button><br>
                    <button
                        onclick="window.openSubscriptionModal('${user._id}', '${
                                    user.subscriptionPlan
                                }')"
                        class="text-blue-600 hover:text-blue-800 font-semibold">
                        Update Plan
                    </button>
                </td>
            `;
                                userTableBody.appendChild(row);
                            });
                        } catch (error) {
                            console.error('Error fetching users:', error);
                        }
                    };

                    window.openSubscriptionModal = (userId, currentPlan) => {
                        selectedUserId = userId;
                        document.getElementById('subscriptionSelect').value =
                            currentPlan;
                        document
                            .getElementById('subscriptionModal')
                            .classList.remove('hidden');
                    };

                    document
                        .getElementById('closeModalBtn')
                        .addEventListener('click', () => {
                            document
                                .getElementById('subscriptionModal')
                                .classList.add('hidden');
                        });

                    document
                        .getElementById('updateSubscriptionBtn')
                        .addEventListener('click', async () => {
                            const newPlan =
                                document.getElementById(
                                    'subscriptionSelect'
                                ).value;

                            try {
                                await axios.put(
                                    `/update-subscription/${selectedUserId}`,
                                    {
                                        subscriptionPlan: newPlan,
                                    }
                                );
                                fetchUsers(); // Refresh the users table
                                document
                                    .getElementById('subscriptionModal')
                                    .classList.add('hidden');
                            } catch (error) {
                                console.error(
                                    'Error updating subscription plan:',
                                    error
                                );
                            }
                        });

                    document
                        .getElementById('searchInput')
                        .addEventListener('input', (e) => {
                            const searchQuery = e.target.value.toLowerCase();
                            const rows =
                                document.querySelectorAll('#userTableBody tr');

                            rows.forEach((row) => {
                                const userId =
                                    row.cells[1].textContent.toLowerCase(); // User ID column
                                const name =
                                    row.cells[2].textContent.toLowerCase(); // Name column
                                const email =
                                    row.cells[3].textContent.toLowerCase(); // Email column

                                if (
                                    userId.includes(searchQuery) ||
                                    name.includes(searchQuery) ||
                                    email.includes(searchQuery)
                                ) {
                                    row.classList.remove('hidden');
                                } else {
                                    row.classList.add('hidden');
                                }
                            });
                        });

                    // Fetch users initially
                    fetchUsers();
                    // delete users
                    window.deleteUser = async (userId) => {
                        const confirmation = confirm(
                            'Are you sure you want to delete this user?'
                        );
                        if (!confirmation) {
                            return; // Exit the function if the user cancels
                        }

                        try {
                            await axios.delete(`/users/${userId}`);
                            fetchUsers(); // Refresh the user list after deletion
                        } catch (error) {
                            console.error('Error deleting user:', error);
                        }
                    };

                    fetchUsers();
                });
            </script>

            <script>
                const sidebarLinks =
                    document.querySelectorAll('.cursor-pointer');
                const sections = document.querySelectorAll(
                    '#manageAdminSection, #manageAvatarSection, #managePackageAndPricingSection, #manageUsersSection, #manageProjectsSection, #toggleVisabilitySection, #manageSubmitsAndPricingSection, #changeAdminPasswordSection, #adminListSection'
                );

                // Function to hide all sections
                const hideAllSections = () => {
                    sections.forEach((section) =>
                        section.classList.add('hidden')
                    );
                };

                // Function to show the relevant section
                const showSection = (sectionId) => {
                    hideAllSections();
                    document
                        .getElementById(sectionId)
                        .classList.remove('hidden');
                };

                // Event listener for sidebar links
                sidebarLinks.forEach((link) => {
                    link.addEventListener('click', (e) => {
                        const targetId = e.target.id;

                        if (targetId === 'manageAdminBtn') {
                            showSection('manageAdminSection');
                        } else if (targetId === 'manageUsersBtn') {
                            showSection('manageUsersSection');
                        } else if (targetId === 'manageProjectsBtn') {
                            showSection('manageProjectsSection');
                        } else if (targetId === 'toggleVisability') {
                            showSection('toggleVisabilitySection');
                        } else if (targetId === 'manageSubmitsAndPricing') {
                            showSection('manageSubmitsAndPricingSection');
                        } else if (
                            targetId === 'changeAdminPasswordSectionBtn'
                        ) {
                            showSection('changeAdminPasswordSection');
                        } else if (targetId === 'adminListBtn') {
                            showSection('adminListSection');
                        } else if (targetId === 'registerAdmin') {
                            showSection('manageAdminSection');
                        } else if (targetId === 'manageAvatarBtn') {
                            showSection('manageAvatarSection');
                        }

                        // Toggle visibility of nested ul elements
                        const nestedUl = e.target.nextElementSibling;
                        if (nestedUl && nestedUl.tagName === 'UL') {
                            nestedUl.classList.toggle('hidden');
                        }
                    });
                });
            </script>
            <script>
                document
                    .getElementById('admin-password-form')
                    .addEventListener('submit', async function (event) {
                        event.preventDefault();

                        const email = document.getElementById('email').value;
                        const password =
                            document.getElementById('password').value;

                        try {
                            const response = await axios.post(
                                '/admin/adminChangePassword',
                                { email, password }
                            );

                            if (response.status === 200) {
                                document.getElementById(
                                    'changePasswordMessage'
                                ).textContent =
                                    'Password changed successfully!';
                                document
                                    .getElementById('changePasswordMessage')
                                    .classList.add('text-green-500');
                            }
                        } catch (error) {
                            document.getElementById(
                                'changePasswordMessage'
                            ).textContent =
                                error.response.data.msg ||
                                'Error changing password';
                            document
                                .getElementById('changePasswordMessage')
                                .classList.add('text-red-500');
                        }
                    });

                document.addEventListener('DOMContentLoaded', function () {
                    const adminTableBody =
                        document.querySelector('#adminTable tbody');

                    // Fetch the admin data from the API
                    fetch('/admin/admins')
                        .then((response) => response.json())
                        .then((admins) => {
                            // Clear the table body
                            adminTableBody.innerHTML = '';

                            // Populate the table with the fetched admins
                            admins.forEach((admin) => {
                                const row = document.createElement('tr');
                                row.classList.add('border-t'); // Add border to each row

                                const idCell = document.createElement('td');
                                idCell.textContent = admin._id;
                                idCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(idCell);

                                const emailCell = document.createElement('td');
                                emailCell.textContent = admin.email;
                                emailCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(emailCell);

                                const isSuperUserCell =
                                    document.createElement('td');
                                isSuperUserCell.textContent = admin.isSuperuser
                                    ? 'Yes'
                                    : 'No';
                                isSuperUserCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(isSuperUserCell);

                                const actionsCell =
                                    document.createElement('td');
                                actionsCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                const deleteButton =
                                    document.createElement('button');
                                deleteButton.textContent = 'Delete';
                                deleteButton.classList.add(
                                    'bg-red-500',
                                    'hover:bg-red-600',
                                    'text-white',
                                    'font-bold',
                                    'py-1',
                                    'px-3',
                                    'rounded'
                                ); // Add Tailwind classes to the button
                                deleteButton.addEventListener('click', () =>
                                    handleDelete(admin._id)
                                );
                                actionsCell.appendChild(deleteButton);
                                row.appendChild(actionsCell);

                                adminTableBody.appendChild(row);
                            });
                        })
                        .catch((error) =>
                            console.error('Error fetching admins:', error)
                        );
                });

                // Handle delete action
                function handleDelete(adminId) {
                    if (
                        confirm('Are you sure you want to delete this admin?')
                    ) {
                        fetch(`/admin/admins/${adminId}`, {
                            method: 'DELETE',
                        })
                            .then((response) => response.json())
                            .then((result) => {
                                alert(result.message);
                                location.reload(); // Reload the page to reflect changes
                            })
                            .catch((error) =>
                                console.error('Error deleting admin:', error)
                            );
                    }
                }
            </script>

            <script>
                document
                    .getElementById('logoutBtn')
                    .addEventListener('click', function (event) {
                        event.preventDefault(); // Prevent the default link behavior

                        // Send a GET request to the logout endpoint
                        fetch('/admin/logout', {
                            method: 'GET',
                            credentials: 'include', // Include cookies in the request
                        })
                            .then((response) => {
                                if (response.ok) {
                                    // Redirect to login page after successful logout
                                    window.location.href = '/admin-login.html';
                                } else {
                                    console.error('Logout failed');
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    'An error occurred during logout:',
                                    error
                                );
                            });
                    });
            </script>
            <script src="./js/create-avatar.js"></script>
            <!-- <script src="./js/create-plan.js"></script> -->
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    // Function to toggle dropdown visibility
                    function toggleDropdown(event) {
                        const dropdown = event.currentTarget.nextElementSibling; // Get the next <ul> which is the dropdown
                        if (dropdown) {
                            dropdown.classList.toggle('hidden'); // Toggle the hidden class
                        }
                    }

                    // Attach event listeners to elements
                    document
                        .getElementById('manageAdminBtn')
                        .addEventListener('click', toggleDropdown);
                    document
                        .getElementById('manageProjectAiBtn')
                        .addEventListener('click', toggleDropdown);
                });
            </script>
        </div>
    </body>
</html>
