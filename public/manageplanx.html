<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Dashboard</title>
        <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.4/dist/tailwind.min.css"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="css/app.css" />
        <link
            rel="stylesheet"
            href="assets/css/plugins/fontawesome-all.min.css"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap"
            rel="stylesheet"
        />
        <link rel="preconnect" href="https://fonts.googleapis.com/" />
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <style>
            /* Custom class for the <a> elements */
            li {
                color: #f97316; /* Tailwind's text-orange-500 */
                background-color: transparent; /* Default background color */
                padding: 0.5rem 1rem; /* px-4 py-2 */
                border-radius: 0.5rem; /* rounded-lg */
                transition: color 0.3s ease, background-color 0.3s ease; /* transition-colors duration-300 */
                text-decoration: none; /* Remove underline from links */
            }

            li:hover {
                color: #f97316; /* Tailwind's hover:text-orange-700 (same color in this example) */
                background-color: #fef3c7; /* Tailwind's hover:bg-orange-100 */
            }
        </style>
        <style>
            /* Sidebar Styling */
            .Sidebar--bars {
                height: 100vh;
                width: 20% !important;
                background-color: #252a34;
                color: #fff;
                font-size: 14px;
                padding-top: 20px;
            }

            .sidebar {
                padding: 20px;
            }
            li {
                color: #f97316; /* Tailwind's text-orange-500 */
                background-color: transparent; /* Default background color */
                padding: 0.5rem 1rem; /* px-4 py-2 */
                border-radius: 0.5rem; /* rounded-lg */
                transition: color 0.3s ease, background-color 0.3s ease; /* transition-colors duration-300 */
                text-decoration: none; /* Remove underline from links */
            }

            li:hover {
                color: #f97316; /* Tailwind's hover:text-orange-700 (same color in this example) */
                background-color: #fef3c7; /* Tailwind's hover:bg-orange-100 */
            }
        </style>
    </head>
    <body class="bg-gray-100">
        <div class="flex">
            <!-- Sidebar -->
            <div class="w-64 h-screen bg-dark sidebar text-white Sidebar--bars">
                <div class="p-4 text-2xl font-semibold">Admin Dashboard</div>
                <div class="sideBar">
                    <div class="sidebar-admin">
                        <ul class="mt-8" id="listAllnavigators">
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageAdminBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageAdminBtn"
                                    >Manage Admin</a
                                >
                            </li>

                            <ul class="ml-4 mt-2 hidden" id="allAdminFunctions">
                                <li
                                    class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                    id="registerAdmin"
                                >
                                    ðŸš€ Register Admin
                                </li>
                                <li
                                    class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                    id="changeAdminPasswordSectionBtn"
                                >
                                    ðŸš€ Change Admin Password
                                </li>
                                <li
                                    class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                    id="adminListBtn"
                                >
                                    ðŸš€ Admin List
                                </li>
                            </ul>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageUsersBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageUsersBtn"
                                    >Manage Users</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageSubmitsAndPricingBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageSubmitsAndPricingBtn"
                                >
                                    Manage User Submits and Pricing</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageProjectAiBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageProjectAiBtn"
                                    >Manage Projects</a
                                >
                            </li>
                            <ul
                                class="ml-4 mt-2 custom-li hidden"
                                id="manageProjectslinkBtn"
                            >
                                <li
                                    class="px-4 py-2 over:bg-gray-600 cursor-pointer"
                                    data-category=""
                                >
                                    ðŸš€ All Projects
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Video Editor AI"
                                >
                                    ðŸš€ Video Editor
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Video Restyling AI"
                                >
                                    ðŸš€ Video Restyle
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Video Voicing"
                                >
                                    ðŸš€ Video Voicing
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Lip Sync AI"
                                >
                                    ðŸš€ Lip Sync
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Face Swap AI"
                                >
                                    ðŸš€ Face Swap
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="3D Video Modeling AI"
                                >
                                    ðŸš€ 3D Video Modeling
                                </li>
                                <li
                                    class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                    data-category="Add Avatar"
                                >
                                    ðŸš€ My Avatar
                                </li>
                            </ul>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageplanBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageplanBtn"
                                    >Manage Plans Pricing View</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="addplanBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=addplanBtn"
                                >
                                    Add More Pricing Plan View</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="ManageComparisonBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=ManageComparisonBtn"
                                >
                                    Manage Pricing Plan View Comparison</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="AddComparisonBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=AddComparisonBtn"
                                    >Add More Pricing Plan Comparison</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                id="manageAvatarBtn"
                            >
                                <a href="manageavatar.html">Manage Avatar</a>
                            </li>
                            <li
                                class="router px-4 py-2 hover:bg-gray-600 cursor-pointer"
                                id="managePackagesBtn"
                                data-url="manage-packages"
                            >
                                <a href="manageplanx.html"
                                    >Manage subscription Plans and Packages</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageVideoBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageVideoBtn"
                                    >Add video</a
                                >
                            </li>
                            <li
                                class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                                id="manageNewsletterBtn"
                            >
                                <a
                                    href="admin-dashboard.html?trigger=manageNewsletterBtn"
                                    >Manage Newsletter</a
                                >
                            </li>
                        </ul>
                    </div>
                </div>
                <li
                    class="px-4 py-2 custom-li hover:bg-gray-600 cursor-pointer"
                    id="logoutBtn"
                >
                    <a href="/logout">Logout</a>
                </li>
            </div>

            <div class="container mx-auto p-4">
                <h1 class="text-2xl font-bold mb-4">
                    Manage Subscription Packages
                </h1>

                <!-- Section for Adding New Package -->
                <div>
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-2">
                            Add New Package
                        </h2>
                        <button
                            id="AddPackageBtn"
                            class="px-4 py-2 bg-blue-500 text-white rounded"
                        >
                            Add Package
                        </button>
                    </div>

                    <!-- Section for Updating Existing Packages -->
                    <div class="mb-6">
                        <h2 class="text-xl font-semibold mb-2">
                            Update Existing Packages
                        </h2>
                        <button
                            id="UpdatePackageBtn"
                            class="px-4 py-2 bg-green-500 text-white rounded"
                        >
                            Update Package
                        </button>
                    </div>
                </div>
            </div>

            <!-- Container for displaying and managing packages -->
            <div id="packagesContainer" class="space-y-4">
                <!-- Package forms will be dynamically added here -->
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    let AvailablePackages = {};

                    document
                        .getElementById('AddPackageBtn')
                        .addEventListener('click', () =>
                            addNewPackageField(undefined, false)
                        );
                    document
                        .getElementById('UpdatePackageBtn')
                        .addEventListener('click', displayPackagesForUpdate);

                    getPackages();
                });

                async function updatePackage(data) {
                    try {
                        const response = await fetch('/api/packages', {
                            method: 'PUT',
                            body: JSON.stringify(data),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        const data = await response.json();
                        console.log(data);
                    } catch (error) {
                        console.log('ðŸš€ ~ updatePackage ~ error:', error);
                    }
                }

                async function createPackage(data) {
                    try {
                        const response = await fetch('/api/packages', {
                            method: 'POST',
                            body: JSON.stringify(data),
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        });

                        const data = await response.json();
                        console.log(data);
                    } catch (error) {
                        console.log('ðŸš€ ~ createPackage ~ error:', error);
                    }
                }

                function getPackages() {
                    fetch('/api/packages')
                        .then((response) => response.json())
                        .then(async ({ data }) => {
                            const resq = await fetch('/api/packages/list');
                            AvailablePackages = (await resq.json()).data;

                            let options = '';
                            for (const pkg of AvailablePackages.allowedPackages) {
                                options += `<option value='${pkg.name}'>${pkg.name}</option>`;
                            }

                            const packageSelect =
                                document.getElementById('subscriptionPlan');
                            packageSelect.innerHTML = options;

                            for (const pkg of data.pkgs) {
                                addNewPackageField(pkg);
                            }
                        });
                }

                function buildFormData(form) {
                    const formData = new FormData(form);
                    const formObject = {};
                    const benefits = [];

                    for (const [key, value] of formData) {
                        if (key === 'benefits') {
                            benefits.push({ name: value, isAvailable: false });
                        } else if (
                            key === 'isAvailable' &&
                            benefits.length > 0
                        ) {
                            benefits[benefits.length - 1].isAvailable =
                                value == 'on';
                        } else {
                            if (formObject[key]) {
                                if (Array.isArray(formObject[key])) {
                                    formObject[key].push(value);
                                } else {
                                    formObject[key] = [formObject[key], value];
                                }
                            } else {
                                formObject[key] = value;
                            }
                        }
                    }

                    formObject.benefits = benefits;
                    return formObject;
                }

                function addNewPackageField(pkg, isNew = true) {
                    const container = document.createElement('form');
                    const benefitInfoField = document.createElement('p');
                    const benefitcontainer = document.createElement('div');
                    const packagePrice = document.createElement('input');
                    const packageHiddenId = document.createElement('input');
                    const addBenefitBtn = document.createElement('button');
                    const removePackageBtn = document.createElement('button');
                    const submitButton = document.createElement('button');
                    const indicator = document.createElement('p');

                    benefitInfoField.innerText =
                        'Please check the box if the corresponding benefit is available for this package';
                    const packageName = document.createElement('select');
                    packageName.name = 'name';
                    packageName.disabled = isNew;

                    const packageInterval = document.createElement('select');
                    packageInterval.name = 'interval';
                    packageInterval.disabled = isNew;

                    AvailablePackages?.allowedIntervals?.forEach((el) => {
                        const option = document.createElement('option');
                        option.value = el;
                        option.innerText = pkg?.interval || el;
                        packageInterval.append(option);
                    });

                    AvailablePackages?.allowedPackages?.forEach((el) => {
                        const option = document.createElement('option');
                        option.value = el.name;
                        option.innerText = pkg?.name || el.name;
                        packageName.append(option);
                    });

                    packageHiddenId.name = 'packageId';
                    packageHiddenId.value = pkg?._id || '';
                    packageHiddenId.hidden = true;

                    packagePrice.name = 'amount';
                    packagePrice.value = pkg?.amount || '';
                    packagePrice.disabled = pkg?.name === 'Free';

                    packageName.placeholder = 'Write Package name';
                    packagePrice.placeholder = 'Add Price';
                    packageInterval.placeholder = 'month, year';

                    container.className =
                        'p-4 border border-blue-500 my-4 bg-gray-300 rounded-md';
                    benefitInfoField.className =
                        'p-4 border my-4 bg-yellow-100 text-yellow-600';
                    benefitcontainer.className = 'p-2';
                    packageName.className = 'p-2 mr-2';
                    indicator.className =
                        'p-2 mr-2 !text-red-500 error-message';
                    packagePrice.className = 'p-2 mr-2';
                    packageInterval.className = 'p-2 mr-2';

                    addBenefitBtn.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2';
                    removePackageBtn.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2';
                    submitButton.className =
                        'p-2 border bg-gray-500 rounded-md text-white mr-2 text-white';

                    removePackageBtn.type = 'button';
                    addBenefitBtn.type = 'button';
                    submitButton.type = 'submit';

                    addBenefitBtn.innerText = 'Add benefit';
                    removePackageBtn.innerText = 'Dismiss Section';
                    submitButton.innerText = 'Create Package';

                    pkg?.benefits.map((b) => {
                        addBenefitField(benefitcontainer, b);
                    });

                    addBenefitBtn.addEventListener('click', () =>
                        addBenefitField(benefitcontainer, undefined)
                    );
                    removePackageBtn.addEventListener('click', () => {
                        if (
                            packageName.value.length < 2 ||
                            packagePrice.value.length < 2 ||
                            packageInterval.value.length < 2
                        ) {
                            if (confirm('Your inputs will be cleared')) {
                                container.remove();
                            }
                        } else {
                            container.remove();
                        }
                    });

                    container.append(
                        packageName,
                        packagePrice,
                        packageInterval,
                        addBenefitBtn,
                        removePackageBtn,
                        packageHiddenId
                    );
                    container.append(benefitInfoField, benefitcontainer);
                    container.append(indicator, submitButton);

                    container.addEventListener('submit', (event) =>
                        handleSubmitNewPackage(event, indicator)
                    );

                    document
                        .getElementById('packagesContainer')
                        .append(container);
                }

                async function handleSubmitNewPackage(event, indicator) {
                    event.preventDefault();

                    const formData = buildFormData(event.target);
                    const formElements = event.target.elements;

                    try {
                        for (let i = 0; i < formElements.length; i++) {
                            formElements[i].disabled = true;
                        }
                        indicator.textContent =
                            'Please wait. Submitting Plan....';

                        const response = await fetch(
                            `/api/packages${
                                formData?.packageId
                                    ? `/${formData?.packageId}`
                                    : ''
                            }`,
                            {
                                method: `${
                                    formData?.packageId ? `PUT` : 'POST'
                                }`,
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ packages: formData }),
                            }
                        );

                        const data = await response.json();
                        if (!data.success) {
                            indicator.textContent = data.errors;
                            return;
                        }

                        indicator.textContent = 'Plan Created successfully';
                    } catch (error) {
                        console.log(
                            'ðŸš€ ~ handleSubmitNewPackage ~ error:',
                            error
                        );
                        indicator.textContent = 'An error occurred';
                    } finally {
                        for (let i = 0; i < formElements.length; i++) {
                            formElements[i].disabled = false;
                        }

                        setTimeout(() => {
                            indicator.textContent = '';
                        }, 2500);
                    }
                }

                function addBenefitField(container, benefit) {
                    const benefitInput = document.createElement('input');
                    const isAvailableCheckbox = document.createElement('input');
                    const removeBenefitBtn = document.createElement('button');

                    benefitInput.name = 'benefits';
                    benefitInput.placeholder = 'Add Benefit';
                    benefitInput.value = benefit?.name || '';
                    benefitInput.className = 'p-2 mr-2';

                    isAvailableCheckbox.type = 'checkbox';
                    isAvailableCheckbox.name = 'isAvailable';
                    isAvailableCheckbox.checked = benefit?.isAvailable || false;

                    removeBenefitBtn.type = 'button';
                    removeBenefitBtn.innerText = 'Remove Benefit';
                    removeBenefitBtn.className =
                        'p-2 border bg-red-500 text-white rounded-md ml-2';
                    removeBenefitBtn.addEventListener('click', () => {
                        container.removeChild(benefitInput);
                        container.removeChild(isAvailableCheckbox);
                        container.removeChild(removeBenefitBtn);
                    });

                    container.append(
                        benefitInput,
                        isAvailableCheckbox,
                        removeBenefitBtn
                    );
                }

                function displayPackagesForUpdate() {
                    const container =
                        document.getElementById('packagesContainer');
                    container.innerHTML = '';

                    fetch('/api/packages')
                        .then((response) => response.json())
                        .then(async ({ data }) => {
                            data.pkgs.forEach((pkg) => {
                                addNewPackageField(pkg, false);
                            });
                        });
                }
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const routers = document.querySelectorAll('.router');
                    const path = new URL(window.location).pathname;

                    routers.forEach(
                        (el) => el.addEventListener('click', handleRouting),
                        false
                    );

                    function handleRouting($this) {
                        const url = $this.target.dataset.url;
                        window.history.pushState(url, undefined, `/${url}`);
                        document
                            .querySelectorAll(`.sidebar-content`)
                            .forEach((el) => el.classList.add('hidden'));
                        document
                            .querySelector(`.${url.replaceAll('/', '')}`)
                            .classList.remove('hidden');
                    }
                });
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', () => {
              
                    const fetchUsers = async () => {
                        try {
                            const response = await axios.get('/api/users');
                            const users = response.data.users;
                            const userTableBody =
                                document.getElementById('userTableBody');
                            userTableBody.innerHTML = '';

                            users.forEach((user, index) => {
                                const row = document.createElement('tr');
                                row.classList.add(
                                    'bg-gray-100',
                                    'border-b',
                                    'hover:bg-gray-200',
                                    'text-sm',
                                    'font-medium'
                                );

                                row.innerHTML = `
                <td class="py-2 px-4">${index + 1}</td>
                <td class="py-2 px-4">${user._id}</td>
                <td class="py-2 px-4">${user.firstName} ${
                                    user.lastName || ''
                                }</td>
                <td class="py-2 px-4">${user.email}</td>
                <td class="py-2 px-4">${user.phoneNumber || 'N/A'}</td>
                <td class="py-2 px-4">${user.address || 'N/A'}</td>
                <td class="py-2 px-4">${user.subscriptionPlan}</td>
                <td class="py-2 px-4">
                    <button
                        onclick="deleteUser('${user._id}')"
                        class="text-red-600 hover:text-red-800 font-semibold mr-4">
                        Delete user
                    </button><br>
                    <button
                        onclick="window.openSubscriptionModal('${user._id}', '${
                                    user.subscriptionPlan
                                }')"
                        class="text-blue-600 hover:text-blue-800 font-semibold">
                        Update Plan
                    </button>
                </td>
            `;
                                userTableBody.appendChild(row);
                            });
                        } catch (error) {
                            console.error('Error fetching users:', error);
                        }
                    };

                    window.openSubscriptionModal = (userId, currentPlan) => {
                        selectedUserId = userId;
                        document.getElementById('subscriptionSelect').value =
                            currentPlan;
                        document
                            .getElementById('subscriptionModal')
                            .classList.remove('hidden');
                    };

                    document
                        .getElementById('closeModalBtn')
                        .addEventListener('click', () => {
                            document
                                .getElementById('subscriptionModal')
                                .classList.add('hidden');
                        });

                    document
                        .getElementById('updateSubscriptionBtn')
                        .addEventListener('click', async () => {
                            const newPlan =
                                document.getElementById(
                                    'subscriptionSelect'
                                ).value;

                            try {
                                await axios.put(
                                    `/update-subscription/${selectedUserId}`,
                                    {
                                        subscriptionPlan: newPlan,
                                    }
                                );
                                fetchUsers(); // Refresh the users table
                                document
                                    .getElementById('subscriptionModal')
                                    .classList.add('hidden');
                            } catch (error) {
                                console.error(
                                    'Error updating subscription plan:',
                                    error
                                );
                            }
                        });

                    document
                        .getElementById('searchInput')
                        .addEventListener('input', (e) => {
                            const searchQuery = e.target.value.toLowerCase();
                            const rows =
                                document.querySelectorAll('#userTableBody tr');

                            rows.forEach((row) => {
                                const userId =
                                    row.cells[1].textContent.toLowerCase(); // User ID column
                                const name =
                                    row.cells[2].textContent.toLowerCase(); // Name column
                                const email =
                                    row.cells[3].textContent.toLowerCase(); // Email column

                                if (
                                    userId.includes(searchQuery) ||
                                    name.includes(searchQuery) ||
                                    email.includes(searchQuery)
                                ) {
                                    row.classList.remove('hidden');
                                } else {
                                    row.classList.add('hidden');
                                }
                            });
                        });

                    // Fetch users initially
                    fetchUsers();
                    // delete users
                    window.deleteUser = async (userId) => {
                        const confirmation = confirm(
                            'Are you sure you want to delete this user?'
                        );
                        if (!confirmation) {
                            return; // Exit the function if the user cancels
                        }

                        try {
                            await axios.delete(`/users/${userId}`);
                            fetchUsers(); // Refresh the user list after deletion
                        } catch (error) {
                            console.error('Error deleting user:', error);
                        }
                    };

                    fetchUsers();
                });
            </script>

            <script>
                const sidebarLinks =
                    document.querySelectorAll('.cursor-pointer');
                const sections = document.querySelectorAll(
                    '#manageAdminSection, #manageAvatarSection, #managePackageAndPricingSection, #manageUsersSection, #manageProjectsSection, #toggleVisabilitySection, #manageSubmitsAndPricingSection, #changeAdminPasswordSection, #adminListSection'
                );

                // Function to hide all sections
                const hideAllSections = () => {
                    sections.forEach((section) =>
                        section.classList.add('hidden')
                    );
                };

                // Function to show the relevant section
                const showSection = (sectionId) => {
                    hideAllSections();
                    document
                        .getElementById(sectionId)
                        .classList.remove('hidden');
                };

                // Event listener for sidebar links
                sidebarLinks.forEach((link) => {
                    link.addEventListener('click', (e) => {
                        const targetId = e.target.id;

                        if (targetId === 'manageAdminBtn') {
                            showSection('manageAdminSection');
                        } else if (targetId === 'manageUsersBtn') {
                            showSection('manageUsersSection');
                        } else if (targetId === 'manageProjectsBtn') {
                            showSection('manageProjectsSection');
                        } else if (targetId === 'toggleVisability') {
                            showSection('toggleVisabilitySection');
                        } else if (targetId === 'manageSubmitsAndPricing') {
                            showSection('manageSubmitsAndPricingSection');
                        } else if (
                            targetId === 'changeAdminPasswordSectionBtn'
                        ) {
                            showSection('changeAdminPasswordSection');
                        } else if (targetId === 'adminListBtn') {
                            showSection('adminListSection');
                        } else if (targetId === 'registerAdmin') {
                            showSection('manageAdminSection');
                        } else if (targetId === 'manageAvatarBtn') {
                            showSection('manageAvatarSection');
                        }

                        // Toggle visibility of nested ul elements
                        const nestedUl = e.target.nextElementSibling;
                        if (nestedUl && nestedUl.tagName === 'UL') {
                            nestedUl.classList.toggle('hidden');
                        }
                    });
                });
            </script>
            <script>
                document
                    .getElementById('admin-password-form')
                    .addEventListener('submit', async function (event) {
                        event.preventDefault();

                        const email = document.getElementById('email').value;
                        const password =
                            document.getElementById('password').value;

                        try {
                            const response = await axios.post(
                                '/admin/adminChangePassword',
                                { email, password }
                            );

                            if (response.status === 200) {
                                document.getElementById(
                                    'changePasswordMessage'
                                ).textContent =
                                    'Password changed successfully!';
                                document
                                    .getElementById('changePasswordMessage')
                                    .classList.add('text-green-500');
                            }
                        } catch (error) {
                            document.getElementById(
                                'changePasswordMessage'
                            ).textContent =
                                error.response.data.msg ||
                                'Error changing password';
                            document
                                .getElementById('changePasswordMessage')
                                .classList.add('text-red-500');
                        }
                    });

                document.addEventListener('DOMContentLoaded', function () {
                    const adminTableBody =
                        document.querySelector('#adminTable tbody');

                    // Fetch the admin data from the API
                    fetch('/admin/admins')
                        .then((response) => response.json())
                        .then((admins) => {
                            // Clear the table body
                            adminTableBody.innerHTML = '';

                            // Populate the table with the fetched admins
                            admins.forEach((admin) => {
                                const row = document.createElement('tr');
                                row.classList.add('border-t'); // Add border to each row

                                const idCell = document.createElement('td');
                                idCell.textContent = admin._id;
                                idCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(idCell);

                                const emailCell = document.createElement('td');
                                emailCell.textContent = admin.email;
                                emailCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(emailCell);

                                const isSuperUserCell =
                                    document.createElement('td');
                                isSuperUserCell.textContent = admin.isSuperuser
                                    ? 'Yes'
                                    : 'No';
                                isSuperUserCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                row.appendChild(isSuperUserCell);

                                const actionsCell =
                                    document.createElement('td');
                                actionsCell.classList.add(
                                    'py-4',
                                    'px-6',
                                    'text-sm',
                                    'text-gray-700'
                                ); // Add Tailwind classes to the cell
                                const deleteButton =
                                    document.createElement('button');
                                deleteButton.textContent = 'Delete';
                                deleteButton.classList.add(
                                    'bg-red-500',
                                    'hover:bg-red-600',
                                    'text-white',
                                    'font-bold',
                                    'py-1',
                                    'px-3',
                                    'rounded'
                                ); // Add Tailwind classes to the button
                                deleteButton.addEventListener('click', () =>
                                    handleDelete(admin._id)
                                );
                                actionsCell.appendChild(deleteButton);
                                row.appendChild(actionsCell);

                                adminTableBody.appendChild(row);
                            });
                        })
                        .catch((error) =>
                            console.error('Error fetching admins:', error)
                        );
                });

                // Handle delete action
                function handleDelete(adminId) {
                    if (
                        confirm('Are you sure you want to delete this admin?')
                    ) {
                        fetch(`/admin/admins/${adminId}`, {
                            method: 'DELETE',
                        })
                            .then((response) => response.json())
                            .then((result) => {
                                alert(result.message);
                                location.reload(); // Reload the page to reflect changes
                            })
                            .catch((error) =>
                                console.error('Error deleting admin:', error)
                            );
                    }
                }
            </script>

            <script>
                document
                    .getElementById('logoutBtn')
                    .addEventListener('click', function (event) {
                        event.preventDefault(); // Prevent the default link behavior

                        // Send a GET request to the logout endpoint
                        fetch('/admin/logout', {
                            method: 'GET',
                            credentials: 'include', // Include cookies in the request
                        })
                            .then((response) => {
                                if (response.ok) {
                                    // Redirect to login page after successful logout
                                    window.location.href = '/admin-login.html';
                                } else {
                                    console.error('Logout failed');
                                }
                            })
                            .catch((error) => {
                                console.error(
                                    'An error occurred during logout:',
                                    error
                                );
                            });
                    });
            </script>
            <script src="./js/create-avatar.js"></script>
            <!-- <script src="./js/create-plan.js"></script> -->
        </div>
    </body>
</html>
