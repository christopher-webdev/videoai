<!DOCTYPE html>
<html lang="en">
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-style-mode" content="" />
        <!-- 0 == light, 1 == dark -->

        <title>Cashvipe Video AI</title>
        <!-- Favicon -->
        <link
            rel="shortcut icon"
            type="image/x-icon"
            href="assets/images/logo/favicon.png"
        />
        <!-- CSS ============================================ -->
        <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css" />
        <link
            rel="stylesheet"
            href="assets/css/plugins/fontawesome-all.min.css"
        />
        <link rel="stylesheet" href="assets/css/plugins/feature.css" />
        <link rel="stylesheet" href="assets/css/plugins/animation.css" />
        <link rel="stylesheet" href="assets/css/plugins/slick.css" />
        <link rel="stylesheet" href="assets/css/plugins/slick-theme.css" />
        <link
            rel="stylesheet"
            href="assets/css/plugins/bootstrap-select.min.css"
        />
        <link rel="stylesheet" href="assets/css/plugins/prism.css" />
        <link rel="stylesheet" href="assets/css/style.css" />
        <link
            href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
            rel="stylesheet"
        />
        <style>
            table {
                border: 10px solid #ddd; /* Light gray border for the table */
            }

            table th,
            table td {
                padding: 12px; /* Adds padding to the table cells for better spacing */

                border-bottom: 5px solid #ddd; /* Light gray border between rows */
            }

            table th {
                background-color: #e0e0e0; /* Slightly darker background for table headers */
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <body>
        <main class="page-wrapper">
            <!-- Start Header Area  -->
            <header
                class="rainbow-header header-default header-transparent header-sticky"
            >
                <div class="container position-relative">
                    <div class="row align-items-center row--0">
                        <div class="col-lg-2 col-md-6 col-6">
                            <div class="logo">
                                <a href="index.html">
                                    <img
                                        class="logo-light"
                                        src="assets/images/logo/logo.png"
                                        alt="ChatBot Logo"
                                    />
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-8 d-none d-lg-block">
                            <nav
                                class="mainmenu-nav d-none d-lg-flex justify-content-center"
                            >
                                <ul class="mainmenu">
                                    <li><a href="index.html">Home</a></li>

                                    <li>
                                        <a href="utilize.html">How to use</a>
                                    </li>
                                    <li>
                                        <a href="affiliate.html">Affiliate</a>
                                    </li>
                                    <li>
                                        <a href="contact.html">Contact us</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        <div class="col-lg-2 col-md-6 col-6 position-static">
                            <div class="header-right">
                                <!-- Start Header Btn  -->
                                <div class="header-btn">
                                    <a
                                        class="rainbow-gradient-btn"
                                        href="dashboard.html"
                                        ><span>Dashboard</span></a
                                    >
                                </div>
                                <!-- End Header Btn  -->

                                <!-- Start Mobile-Menu-Bar -->
                                <div
                                    class="mobile-menu-bar ml--5 d-flex justify-content-end d-lg-none"
                                >
                                    <div class="hamberger">
                                        <button class="hamberger-button">
                                            <i
                                                class="fa-sharp fa-regular fa-bars"
                                            ></i>
                                        </button>
                                    </div>
                                </div>
                                <!-- Start Mobile-Menu-Bar -->
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- End Header Area  -->
            <div class="popup-mobile-menu">
                <div class="inner-popup">
                    <div class="header-top">
                        <div class="logo">
                            <a href="index.html">
                                <img
                                    class="logo-light"
                                    src="assets/images/logo/logo.png"
                                    alt="ChatBot Logo"
                                />
                            </a>
                        </div>
                        <div class="close-menu">
                            <button class="close-button">
                                <i class="fa-sharp fa-regular fa-x"></i>
                            </button>
                        </div>
                    </div>
                    <div class="content">
                        <ul class="mainmenu">
                            <li><a href="index.html">Home</a></li>

                            <li><a href="utilize.html">How to use</a></li>
                            <li><a href="affiliate.html">Affiliate</a></li>
                            <li><a href="contact.html">Contact us</a></li>
                        </ul>
                        <div class="rbt-sm-separator"></div>
                        <div class="rbt-default-sidebar-wrapper">
                            <nav class="mainmenu-nav">
                                <ul
                                    class="dashboard-mainmenu rbt-default-sidebar-list"
                                ></ul>
                            </nav>
                        </div>
                    </div>

                    <!-- Start Header Btn  -->
                    <div class="header-btn d-block d-md-none">
                        <a class="btn-default @@btnClass" href="dashboard.html"
                            >Back to Dashboaard</a
                        >
                    </div>
                    <!-- End Header Btn  -->
                </div>
            </div>

            <!--  Preloader -->
            <div class="preloader">
                <div class="loader">
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                    <div class="circle"></div>
                </div>
            </div>

            <!-- Start Slider Area  -->

            <!-- End Slider Area  -->
            <br /><br />
            <br /><br /><br /><br />

            <!-- Start Collabration-Style-One  -->
            <div class="rainbow-collobration-area">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div
                                class="section-title text-center"
                                data-sal="slide-up"
                                data-sal-duration="700"
                                data-sal-delay="100"
                            >
                                <h2 class="subtitle">
                                    <span class="theme-gradient"
                                        >Affiliate Program</span
                                    >
                                </h2>
                                <p>
                                    Refer friend and relatives to earn from our
                                    affiliate program
                                </p>
                                <h2 class="text-white text-bold">
                                    <span class=" mr-2" id="amountEarned">0.00</span>
                                </h2>
                                <p class="text-referral">
                                    (<span class="text-sm">
                                        <span
                                        id="text_num_referral"
                                        class="theme-gradient"
                                        >0</span
                                    >
                                    <span
                                        class="small"
                                        style="color: var(--color-body)"
                                        >referred</span
                                    >
                                    </span>)
                                </p>
                                <div class="container py-4 mt-4">
                                    <div class="">
                                        <div class="row justify-content-center">
                                            <div class="col-12">
                                                <div class="input-group">
                                                    <button
                                                        class="btn btn-dark btn-block"
                                                        id="copy_my_referral_link"
                                                    >
                                                        Copy Link
                                                    </button>
                                                    <input
                                                        type="text"
                                                        name="referral_link"
                                                        id="referral_link"
                                                        value=""
                                                        class="form-control"
                                                        readonly
                                                    />
                                                </div>
                                                <div
                                                    class="form-group mt-2 requestforwithdraw"
                                                >
                                                    <button
                                                        id="requestforwithdrawBtn"
                                                        type="button"
                                                        class="btn btn-primary btn-lg"
                                                    >
                                                        Withdrawal Request
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6 col-md-12 mt--60">
                                <div class="row istify-content-center">
                                    <div class="col-lg-4 col-md-12">
                                        <div class="row">
                                            <div class="col-lg-12 col-md-6 p-2">
                                                <button
                                                    class="selector-sec btn btn-block active"
                                                    id="paypal"
                                                >
                                                    Paypal
                                                </button>
                                            </div>
                                            <div class="col-lg-12 col-md-6 p-2">
                                                <button
                                                    class="selector-sec btn btn-block"
                                                    id="credit_card"
                                                >
                                                    Credit Card
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div
                                            class="container-paypal p-2"
                                            id="container-paypal"
                                        >
                                            <form
                                                action="/paypal-pay"
                                                id="process-paypal"
                                            >
                                                <div class="form-group">
                                                    <input
                                                        type="text"
                                                        placeholder="Enter Paypal address"
                                                        name="paypaladdress"
                                                        id="paypaladdress"
                                                        class="form-control"
                                                    />
                                                </div>
                                                <button
                                                    class="btn btn-warning btn-block"
                                                >
                                                    Update Payment
                                                </button>
                                            </form>
                                        </div>
                                        <div
                                            class="container-credit-card p-2"
                                            id="container-credit-card"
                                        >
                                            <form
                                                action="/credit-card"
                                                id="process-credit-card"
                                            >
                                                <div class="form-group">
                                                    <label for="cardNumber"
                                                        >Enter Card
                                                        Number</label
                                                    >
                                                    <input
                                                        type="text"
                                                        placeholder="11111 1111 1111 1111"
                                                        id="cardNumber"
                                                        name="cardNumber"
                                                        class="form-control"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <label for="cardName"
                                                        >Enter Card Holder
                                                        Name</label
                                                    >
                                                    <input
                                                        type="text"
                                                        placeholder="Enter Card Name"
                                                        id="cardName"
                                                        name="cardName"
                                                        class="form-control"
                                                    />
                                                </div>
                                                <div class="form-group">
                                                    <label
                                                        for="Choose Expiring Date"
                                                    ></label>
                                                    <input
                                                        type="month"
                                                        placeholder="Enter Card Expiring Date"
                                                        id="cardExp"
                                                        name="cardExp"
                                                        class="form-control"
                                                    />
                                                </div>
                                                <button
                                                    class="btn btn-warning btn-block"
                                                >
                                                    Update Payment
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-12 mt--60">
                                <p class="text-center">Affiliate History</p>
                                <div class="container-table">
                                    <table id="referral-table">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>First Name</th>
                                                <th>Last Name</th>
                                                <th>Earning</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Table rows will be inserted here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Collabration-Style-One  -->

                <style>
                    button.selector-sec {
                        border: none;
                        border: 2px solid var(--color-body);
                        color: #fff;
                        background: transparent;
                        outline: none;
                        text-align: center;
                        text-transform: uppercase;
                        padding: 10px;
                    }
                    button.selector-sec.active {
                        background: var(--color-body);
                    }
                    #container-credit-card {
                        display: none;
                    }
                </style>
                <script>
                    document
                        .getElementById('paypal')
                        .addEventListener('click', function () {
                            document.getElementById(
                                'container-credit-card'
                            ).style.display = 'none'; // Hide credit card container
                            document.getElementById(
                                'container-paypal'
                            ).style.display = 'block'; // Show PayPal container
                            document
                                .getElementById('paypal')
                                .classList.add('active'); // Add 'active' class to PayPal button
                            document
                                .getElementById('credit_card')
                                .classList.remove('active'); // Remove 'active' class from Credit Card button
                        });

                    document
                        .getElementById('credit_card')
                        .addEventListener('click', function () {
                            document.getElementById(
                                'container-credit-card'
                            ).style.display = 'block'; // Show credit card container
                            document.getElementById(
                                'container-paypal'
                            ).style.display = 'none'; // Hide PayPal container
                            document
                                .getElementById('paypal')
                                .classList.remove('active'); // Remove 'active' class from PayPal button
                            document
                                .getElementById('credit_card')
                                .classList.add('active'); // Add 'active' class to Credit Card button
                        });
                </script>
                <script>
                    // Handle PayPal Form Submission process-paypal
                    document
                        .getElementById('process-paypal')
                        .addEventListener('submit', async (event) => {
                            event.preventDefault(); // Prevent default form submission

                            const paypaladdress =
                                document.getElementById('paypaladdress').value;

                            try {
                                const response = await fetch(
                                    '/api/paypal-pay',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({ paypaladdress }), // Ensure the key matches server-side expectations
                                    }
                                );

                                const result = await response.json();
                                if (response.ok) {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success',
                                        text: result.msg,
                                    });
                                } else {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text:
                                            result.errors[0].msg ||
                                            'An error occurred',
                                    });
                                }
                            } catch (error) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text:
                                        'An error occurred while submitting PayPal information.' +
                                        error,
                                });
                            }
                        });

                    // Handle Credit Card Form Submission
                    document
                        .getElementById('process-credit-card')
                        .addEventListener('submit', async (event) => {
                            event.preventDefault(); // Prevent default form submission

                            const cardNumber =
                                document.getElementById('cardNumber').value;
                            const cardName =
                                document.getElementById('cardName').value;
                            const cardExp =
                                document.getElementById('cardExp').value;

                            try {
                                const response = await fetch(
                                    '/api/credit-card',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify({
                                            cardNumber,
                                            cardName,
                                            cardExp,
                                        }), // Ensure the keys match server-side expectations
                                    }
                                );

                                const result = await response.json();
                                // console.log(result);

                                if (response.ok) {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success!',
                                        text:
                                            result.msg ||
                                            'PayPal information updated successfully!',
                                        confirmButtonText: 'OK',
                                    });
                                } else {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error!',
                                        text:
                                            result.msg ||
                                            'Error updating PayPal information.',
                                        confirmButtonText: 'OK',
                                    });
                                }
                            } catch (error) {
                                console.error(
                                    'Error submitting payment information:',
                                    error
                                );
                            }
                        });

                    document.addEventListener('DOMContentLoaded', async () => {
                        try {
                            const response = await fetch('/api/user-payment');

                            // Ensure the response is OK
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }

                            const user = await response.json(); // This is where the fetched data is stored
                            // Use the correct variable 'user' instead of 'payment'
                            document.getElementById('paypaladdress').value =
                                user.Paypal || '';
                            document.getElementById('cardNumber').value =
                                user.CardNumber || '';
                            document.getElementById('cardName').value =
                                user.CardName || '';
                            document.getElementById('cardExp').value =
                                user.Expiringdate || '';
                        } catch (error) {
                            console.error(
                                'Error fetching payment information:',
                                error
                            );
                        }
                    });

                    document.addEventListener('DOMContentLoaded', async () => {
                        try {
                            const response = await fetch('/api/referrals');
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }

                            const data = await response.json();
                            console.log("ðŸš€ ~ document.addEventListener ~ data:", data)
                            const tableBody = document.querySelector(
                                '#referral-table tbody'
                            );
                            const numReferralsElement =
                                document.getElementById('text_num_referral');
                            const amountEarned =
                                document.getElementById('amountEarned');

                            // Clear existing table rows
                            tableBody.innerHTML = '';
                            if (data.referrals.length > 0) {
                                // Populate the table with referrals
                                data.referrals.forEach((referral, index) => {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${referral.firstName}</td>
                        <td>${referral.lastName}</td>
                        <td>${referral.amountEarned}</td>
                    `;
                                    tableBody.appendChild(row);
                                });
                            } else {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                        <td colspan="3" class="text-center">You have no referral yet!</td>
                    `;
                                tableBody.appendChild(row);
                            }

                            // const requestforwithdraw=document.getElementById('requestforwithdraw');
                            //         requestforwithdraw.innerHTML='';
                            // Update the number of referrals
                            numReferralsElement.textContent = data.referrals.length;
                            amountEarned.textContent = data.totalEarned
                        } catch (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'An error occurred while fetching referral data.',
                            });
                            console.error(
                                'Error fetching referral data:',
                                error
                            );
                        }
                    });

                    document.addEventListener('DOMContentLoaded', async () => {
                        try {
                            const response = await fetch('/api/referral-info');
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }

                            const data = await response.json();

                            // Get the base URL from the browser
                            const baseUrl = window.location.origin;

                            // Construct the referral link
                            const referralLink = `${baseUrl}/signup?r=${data.referral_id}`;

                            // Ensure the input element exists
                            const referralLinkInput =
                                document.getElementById('referral_link');
                            if (!referralLinkInput) {
                                throw new Error(
                                    'Referral link input element not found'
                                );
                            }

                            // Update the input field with the referral link
                            referralLinkInput.value =
                                referralLink || 'No referral link available';
                        } catch (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: `An error occurred while fetching referral information: ${error.message}`,
                            });
                            console.error(
                                'Error fetching referral information:',
                                error
                            );
                        }
                    });
                    document.addEventListener('DOMContentLoaded', async () => {
                        try {
                            const response = await fetch('/api/referral-info');
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }

                            const data = await response.json();
                            const baseUrl = window.location.origin;
                            const referralLink = `${baseUrl}/signup?r=${data.referral_id}`;

                            const referralLinkInput =
                                document.getElementById('referral_link');
                            if (!referralLinkInput) {
                                throw new Error(
                                    'Referral link input element not found'
                                );
                            }
                            referralLinkInput.value =
                                referralLink || 'No referral link available';
                        } catch (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: `An error occurred while fetching referral information: ${error.message}`,
                            });
                            console.error(
                                'Error fetching referral information:',
                                error
                            );
                        }
                    });

                    // Function to copy the referral link to clipboard
                    document
                        .getElementById('copy_my_referral_link')
                        .addEventListener('click', () => {
                            const referralLinkInput =
                                document.getElementById('referral_link');
                            if (referralLinkInput) {
                                referralLinkInput.select(); // Select the input value
                                document.execCommand('copy'); // Copy the selected value to clipboard

                                Swal.fire({
                                    icon: 'success',
                                    title: 'Copied!',
                                    text: 'Referral link has been copied to clipboard.',
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Referral link input element not found.',
                                });
                            }
                        });

                    document
                        .getElementById('requestforwithdrawBtn')
                        .addEventListener('click', async function () {
                            try {
                                const response = await fetch(
                                    '/api/request-withdrawal',
                                    {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                    }
                                );

                                const result = await response.json();

                                if (result.success) {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Success',
                                        text: result.message,
                                    });
                                } else {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text: result.message,
                                    });
                                }
                            } catch (error) {
                                console.error('Error:', error);
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Something went wrong, please try again later.',
                                });
                            }
                        });
                </script>
                <br /><br /><br /><br /><br /><br /><br />
                <!-- Start Copy Right Area  -->
                <div class="copyright-area copyright-style-one">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-lg-6 col-md-8 col-sm-12 col-12">
                                <div class="copyright-left">
                                    <ul class="ft-menu link-hover">
                                        <li>
                                            <a href="privacy-policy.html"
                                                >Privacy Policy</a
                                            >
                                        </li>
                                        <li>
                                            <a href="contact.html"
                                                >Contact Us</a
                                            >
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-4 col-sm-12 col-12">
                                <div
                                    class="copyright-right text-center text-lg-end"
                                >
                                    <p class="copyright-text">
                                        Copyright Â© 2024
                                        <a href="" class="btn-read-more"
                                            ><span>Cashvipe</span></a
                                        >
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Copy Right Area  -->
                <div class="rbt-progress-parent">
                    <svg
                        class="rbt-back-circle svg-inner"
                        width="100%"
                        height="100%"
                        viewBox="-1 -1 102 102"
                    >
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
                    </svg>
                </div>

                <!-- All Scripts  -->

                <!-- JS
    ============================================ -->
                <script src="assets/js/vendor/modernizr.min.js"></script>
                <script src="assets/js/vendor/jquery.min.js"></script>
                <script src="assets/js/vendor/bootstrap.min.js"></script>
                <script src="assets/js/vendor/waypoint.min.js"></script>
                <script src="assets/js/vendor/wow.min.js"></script>
                <script src="assets/js/vendor/counterup.min.js"></script>
                <script src="assets/js/vendor/sal.min.js"></script>
                <script src="assets/js/vendor/slick.min.js"></script>
                <script src="assets/js/vendor/text-type.js"></script>
                <script src="assets/js/vendor/prism.js"></script>
                <script src="assets/js/vendor/jquery.style.swicher.js"></script>
                <script src="assets/js/vendor/bootstrap-select.min.js"></script>
                <script src="assets/js/vendor/backto-top.js"></script>
                <script src="assets/js/vendor/js.cookie.js"></script>
                <script src="assets/js/vendor/jquery-one-page-nav.js"></script>
                <!-- Main JS -->
                <script src="assets/js/main.js"></script>
            </div>
        </main>
    </body>
</html>
